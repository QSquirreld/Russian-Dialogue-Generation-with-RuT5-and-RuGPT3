# Russian Dialogue Generation with RuT5 and RuGPT3

–†–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ **–¥–∏–∞–ª–æ–≥–æ–≤–æ–≥–æ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è** —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º encoder-decoder –∏ decoder-only –º–æ–¥–µ–ª–µ–π.

–ú–æ–¥–µ–ª–∏ –¥–æ–æ–±—É—á–µ–Ω—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∏–∞–ª–æ–≥–æ–≤ –∏–∑ –¥–∞—Ç–∞—Å–µ—Ç–∞ [`zjkarina/matreshka`](https://huggingface.co/datasets/zjkarina/matreshka).

## –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–°—Ä–∞–≤–Ω–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã encoder-decoder –∏ decoder-only –≤ –∑–∞–¥–∞—á–µ –¥–∏–∞–ª–æ–≥–æ–≤–æ–≥–æ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è.

## –ó–∞–¥–∞—á–∏

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –º–æ–¥–µ–ª–∏ –≤ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –±–ª–∏–∑–∫–æ–º –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –¥–∞—Ç–∞—Å–µ—Ç—É –≤ zero-shot —Ä–µ–∂–∏–º–µ.
2. –ü–æ—Å—á–∏—Ç–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ BLEU –∏ METEOR –∏—Å—Ö–æ–¥–Ω–æ–π –º–æ–¥–µ–ª–∏ –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω–æ–º —Å–∞–±—Å–µ—Ç–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞.
3. –î–æ–æ–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å –Ω–∞ –æ–±—É—á–∞—é—â–µ–º —Å–∞–±—Å–µ—Ç–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞.
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –º–æ–¥–µ–ª–∏ –≤ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –±–ª–∏–∑–∫–æ–º –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –¥–∞—Ç–∞—Å–µ—Ç—É.
5. –ü–æ—Å—á–∏—Ç–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ BLEU –∏ METEOR –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω–æ–º —Å–∞–±—Å–µ—Ç–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞.

## –ú–æ–¥–µ–ª–∏

- encoder-decoder ‚Äî RuT5 ‚Äî [`cointegrated/rut5-small-chitchat2`](https://huggingface.co/cointegrated/rut5-small-chitchat2)
  - –ú–æ–¥–µ–ª—å —Å–µ–º–µ–π—Å—Ç–≤–∞ T5, –¥–æ–æ–±—É—á–µ–Ω–Ω–∞—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.
- decoder only ‚Äî RuGPT3 ‚Äî [`ai-forever/rugpt3small_based_on_gpt2`](https://huggingface.co/ai-forever/rugpt3small_based_on_gpt2)
  - –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è GPT2, –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.

## –î–∞—Ç–∞—Å–µ—Ç

- [`zjkarina/matreshka`](https://huggingface.co/datasets/zjkarina/matreshka) ‚Äî –∫–æ—Ä–ø—É—Å —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤.
- –Ø–∑—ã–∫: `—Ä—É—Å—Å–∫–∏–π`
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∏–∞–ª–æ–≥–æ–≤: `8 319`
- –î–∏–∞–ª–æ–≥–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
  - `role = ['user', 'bot']` ‚Äî —Ä–æ–ª–∏,
  - `dialog = ['–ü—Ä–∏–≤–µ—Ç', '–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?']` ‚Äî —Ä–µ–ø–ª–∏–∫–∏
  - `persona` ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ(—Å–æ—Å—Ç–æ—è–Ω–∏–µ) –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–µ –∏—Å–ø. –≤ –∑–∞–¥–∞—á–µ)
  - `summary` ‚Äî —Å–∞–º–∞—Ä–∏ –¥–∏–∞–ª–æ–≥–∞ (–Ω–µ –∏—Å–ø. –≤ –∑–∞–¥–∞—á–µ)

## –ú–µ—Ç—Ä–∏–∫–∏
- `BLEU` (Bilingual Evaluation Understudy)<br>‚Äî n-–≥—Ä–∞–º–º–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞, –∏–∑–º–µ—Ä—è–µ—Ç —Ç–æ—á–Ω–æ—Å—Ç—å —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –º–µ–∂–¥—É –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ–º –∏ —ç—Ç–∞–ª–æ–Ω–æ–º.
    - –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∫—Ä–∞—Ç–∫–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤
    - –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä–µ—Ñ—Ä–∞–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–∏–Ω–æ–Ω–∏–º—ã
- `METEOR` (Metric for Evaluation of Translation with Explicit ORdering)
    - –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Å–º—ã—Å–ª–æ–≤–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è
    - —É—á–∏—Ç—ã–≤–∞–µ—Ç –ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤, –ª–µ–º–º—ã, —Å–∏–Ω–æ–Ω–∏–º—ã, –ø–µ—Ä–µ—Ñ—Ä–∞–∑–∏—Ä–æ–≤–∞–Ω–∏–µ

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–æ—É—Ç–±—É–∫–æ–≤

1. Zero-Shot —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤

2. –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö
- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ `_df_to_t5_format`/``_df_to_gpt_format``, `_shrink_roles_and_dialogue` –∏ `_drop_first_bot_last_user_utterings`:<br>–î–∏–∞–ª–æ–≥–∏ –ø—Ä–µ–≤–µ–¥–µ–Ω—ã –∫ –≤–∏–¥—É `user` ‚Üí `bot`, —Ç–∞–∫–∂–µ —É–±—Ä–∞–Ω—ã —Ä–∞–∑—Ä—ã–≤—ã
   
3. –¢–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è (—Å–º. "–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏")
- –î–ª—è encoder-decoder:
  - –û—Ç–¥–µ–ª—å–Ω–æ —Ç–æ–∫–µ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è `source_text` –∏ `target_text` —Å –ø–æ–º–æ—â—å—é `T5Tokenizer`
- –î–ª—è decoder-only:
  - –¢–æ–∫–µ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –≤–µ—Å—å —Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞ (–≤–∫–ª—é—á–∞—è `<user>` –∏ `<bot>`)
  - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è `labels`, —Å–æ–≤–ø–∞–¥–∞—é—â–∏–µ —Å `input_ids` (–∫—Ä–æ–º–µ —Ç–æ–∫–µ–Ω–æ–≤ padding)
   
4. Fine-Tuning

5. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –¥–æ–æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏

5. –û—Ü–µ–Ω–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –º–æ–¥–µ–ª–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ `BLEU` –∏ `METEOR`
- *–¥–æ –∏ –ø–æ—Å–ª–µ –¥–æ–æ–±—É—á–µ–Ω–∏—è*

## –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏

–í –ø—Ä–æ–µ–∫—Ç–µ —É—á—Ç–µ–Ω—ã —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞–º–∏ –º–æ–¥–µ–ª–µ–π:<br>
Encoder-Decoder (RuT5):
1. –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –∫ —Ñ–æ—Ä–º–∞—Ç—É source_text ‚Üí target_text
2. –î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–µ—Ñ–∏–∫—Å `–æ—Ç–≤–µ—Ç—å`: –∫ source_text –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏
3. –¢–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –≤—Ö–æ–¥–∞ –∏ –≤—ã—Ö–æ–¥–∞

Decoder-Only (RuGPT3):
1. –¢–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä –¥–æ–ø–æ–ª–Ω–µ–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏: `<user>` –∏ `<bot>`
2. –î–∏–∞–ª–æ–≥–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã –≤ –µ–¥–∏–Ω—ã–π —Ç–µ–∫—Å—Ç —Å —Ä–∞–∑–º–µ—Ç–∫–æ–π —Ä–æ–ª–µ–π (`<user>` –∏ `<bot>`)
    - –∏–º–µ—é—Ç –≤–∏–¥: `<user>USERTEXT<bot>BOTTEXT</s>`

## –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

|–ú–æ–¥–µ–ª—å|–ú–µ—Ç—Ä–∏–∫–∞|–ó–Ω–∞—á–µ–Ω–∏–µ (initial)|–ó–Ω–∞—á–µ–Ω–∏–µ (fine-tuned)|
|------|-------|------------------|---------------------|
|RuT5|BLEU|0.093|0.147|
|RuT5|METEOR|0.045|0.152|
|RuGPT3|BLEU|0.097|0.097|
|RuGPT3|METEOR|0.146|0.146|

## –í—ã–≤–æ–¥—ã

1. "–ò–∑ –∫–æ—Ä–æ–±–∫–∏" `gpt3small` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–µ–±—è –ª—É—á—à–µ `RuT5`, —á—Ç–æ –º–æ–∂–µ—Ç –≥–æ–≤–æ—Ä–∏—Ç—å –æ –ª—É—á—à–µ–º –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–∏–∏ –∏–ª–∏ –ª—É—á—à–µ–º –±–∞–∑–æ–≤–æ–º –∫–∞—á–µ—Å—Ç–≤–µ –¥–ª—è –¥–∏–∞–ª–æ–≥–æ–≤—ã—Ö –∑–∞–¥–∞—á.
2. –ü–æ—Å–ª–µ fine-tuning `RuT5` –ø–æ–∫–∞–∑–∞–ª–∞ –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
- ~–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–∞–æ–±–æ—Ä–æ—Ç –ø–æ –∏–¥–µ–∏..~
3. –ú–µ—Ç—Ä–∏–∫–∏ `gpt3small` –Ω–∏–∫–∞–∫ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å, –æ–¥–Ω–∞–∫–æ —Å–∞–º –æ—Ç–≤–µ—Ç —Å—Ç–∞–ª –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–µ–π.
- –ö–∞–∫ –∏ –æ–∂–∏–¥–∞–ª–æ—Å—å –º–æ–¥–µ–ª—å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –¥–∏–∞–ª–æ–≥, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç `RuT5` –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–≤–µ—á–∞–µ—Ç –∫–æ—Ä–æ—Ç–∫–æ –∏ —ë–º–∫–æ.
4. –ú–µ—Ç—Ä–∏–∫–∏ `RuT5` –ø–æ–¥—Ä–æ—Å–ª–∏
- `METEOR` –≤—ã—Ä–æ—Å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ
5. –ì–æ–≤–æ—Ä—è –≤ –æ–±—â–µ–º –º–µ—Ç—Ä–∏–∫–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ —Å–ª–∞–±—ã–µ.
- –ì–∏–ø–æ—Ç–µ–∑—ã –≤–Ω—É—Ç—Ä–∏ –Ω–æ—É—Ç–±—É–∫–æ–≤. –ì–ª–∞–≤–Ω–∞—è ‚Äî –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö ü§∑üèª‚Äç‚ôÇÔ∏è

## –†–µ–∑—É–ª—å—Ç–∞—Ç

–ú–æ–¥–µ–ª—å —É—Å–ø–µ—à–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã, –æ—Å–æ–±–µ–Ω–Ω–æ –Ω–∞ –∫–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–ª–∏ –±—ã—Ç–æ–≤—ã–µ —Ä–µ–ø–ª–∏–∫–∏. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –±–∞–∑—É –¥–ª—è –¥–æ–æ–±—É—á–µ–Ω–∏—è –ø–æ–¥ –±–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏ (—Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞, –º–µ–¥–∏—Ü–∏–Ω–∞ –∏ —Ç.–¥.).

## –í–æ–∑–º–æ–∂–Ω—ã–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

- Fine-tuning –Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–º –¥–æ–º–µ–Ω–µ (–º–µ–¥–∏—Ü–∏–Ω–∞, –±–∞–Ω–∫–∏)
- –û–±—É—á–∞—Ç—å –º–æ–¥–µ–ª—å –¥–æ–ª—å—à–µ –∏ —Ç—â–∞—Ç–µ–ª—å–Ω–µ–µ (—Ç.–∫. Google Colab –¥–∞—ë—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –∏ –≤—Ä–µ–º—è)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–æ–ª–µ–µ –∫—Ä—É–ø–Ω–æ–π –º–æ–¥–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `rut5-base` –∏–ª–∏ `rugpt3medium`) –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å —É—á—ë—Ç–æ–º –ø–æ–ª—è persona –∏–∑ –¥–∞—Ç–∞—Å–µ—Ç–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º—É–ª—å—Ç–∏-turn –¥–∏–∞–ª–æ–≥–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –æ–±—â–µ–Ω–∏—è (FAQ, small talk, –∏–Ω—Ç–µ—Ä–≤—å—é –∏ —Ç.–¥.)

## –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
```bash
pip install transformers datasets torch pandas tqdm scikit-learn torchmetrics evaluate
```

2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω—É–∂–Ω—ã–π –Ω–æ—É—Ç–±—É–∫
- –ß–µ—Ä–µ–∑ `jupyter`:<br>
```bash
pip install jupyter
jupyter notebook
```
3. –û—Ç–∫—Ä—ã—Ç—å –Ω—É–∂–Ω—ã–π notebook: `Dialogue_Generator_RUT5.ipynb` –∏–ª–∏ `Dialogue_Generator_RUGPT3.ipynb`
4. –ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è GPU (–Ω–∞–ø—Ä–∏–º–µ—Ä, Google Colab —Å `T4/V100/A100`)
- –û–±—ä—ë–º –ø–∞–º—è—Ç–∏: –æ—Ç `12 –ì–ë` –∏ –≤—ã—à–µ –¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è
